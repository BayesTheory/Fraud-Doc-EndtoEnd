<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayes ‚Äî Fraud-Doc Pipeline</title>
    <meta name="description" content="AI-powered document fraud detection with OCR, rules engine, and LLM analysis">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- ‚îÄ‚îÄ‚îÄ SIDEBAR NAV ‚îÄ‚îÄ‚îÄ -->
    <nav id="sidebar">
        <div class="sidebar-brand">
            <div class="brand-icon">B</div>
            <span class="brand-text">Bayes</span>
        </div>
        <div class="sidebar-nav">
            <a href="#/analyze" class="nav-item active" data-page="analyze">
                <span class="nav-icon">üîç</span>
                <span class="nav-label">Analyze</span>
            </a>
            <a href="#/dashboard" class="nav-item" data-page="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </a>
            <a href="#/api" class="nav-item" data-page="api">
                <span class="nav-icon">üì°</span>
                <span class="nav-label">API</span>
            </a>
            <a href="#/pipeline" class="nav-item" data-page="pipeline">
                <span class="nav-icon">üìê</span>
                <span class="nav-label">Pipeline</span>
            </a>
        </div>
        <div class="sidebar-footer">
            <div class="sidebar-status">
                <span class="status-dot online"></span>
                <span>v1.0.0</span>
            </div>
        </div>
    </nav>

    <!-- ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ -->
    <main id="main-content">

        <!-- ‚ïê‚ïê‚ïê PAGE: ANALYZE ‚ïê‚ïê‚ïê -->
        <section id="page-analyze" class="page active">
            <div class="page-header">
                <h1>Document Analysis</h1>
                <p class="page-subtitle">Upload a passport image for AI-powered fraud detection</p>
            </div>

            <div class="analyze-layout">
                <!-- Upload Panel -->
                <div class="upload-panel">
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-content">
                            <div class="drop-icon">üìÑ</div>
                            <p class="drop-title">Drop image here</p>
                            <p class="drop-subtitle">or click to select ¬∑ JPEG, PNG</p>
                        </div>
                        <input type="file" id="file-input" accept="image/*" hidden>
                    </div>

                    <div id="preview-box" class="preview-box hidden">
                        <img id="preview-img" src="" alt="Preview">
                        <div class="preview-info">
                            <span id="preview-name"></span>
                            <button id="preview-clear" class="btn-icon" title="Remove">‚úï</button>
                        </div>
                    </div>

                    <button id="btn-analyze" class="btn-primary btn-full" disabled>
                        <span class="btn-icon-left">üî¨</span> Analyze Document
                    </button>
                    <div class="demo-buttons">
                        <span class="demo-label">‚ö° Live Demo:</span>
                        <div class="demo-actions">
                            <button class="btn-ghost btn-sm demo-btn" onclick="runDemo('approved')">‚úÖ Valid</button>
                            <button class="btn-ghost btn-sm demo-btn" onclick="runDemo('rejected')">‚ùå Fraud</button>
                            <button class="btn-ghost btn-sm demo-btn" onclick="runDemo('review')">‚ö†Ô∏è Review</button>
                        </div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="results-panel">
                    <div id="results-placeholder" class="results-placeholder">
                        <div class="placeholder-icon">üõ°Ô∏è</div>
                        <p>Upload a document to begin analysis</p>
                        <p class="placeholder-sub">Pipeline: Quality ‚Üí OCR ‚Üí Rules ‚Üí LLM</p>
                    </div>

                    <div id="loading-state" class="loading-state hidden">
                        <div class="loading-spinner"></div>
                        <p id="loading-text">Analyzing document...</p>
                        <div class="loading-steps">
                            <div class="load-step" data-step="quality"><span class="step-dot"></span> Quality Gate</div>
                            <div class="load-step" data-step="ocr"><span class="step-dot"></span> OCR Extraction</div>
                            <div class="load-step" data-step="rules"><span class="step-dot"></span> Rules Engine</div>
                            <div class="load-step" data-step="llm"><span class="step-dot"></span> LLM Analysis</div>
                        </div>
                    </div>

                    <div id="results-content" class="results-content hidden"></div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê PAGE: DASHBOARD ‚ïê‚ïê‚ïê -->
        <section id="page-dashboard" class="page">
            <!-- Login Gate -->
            <div id="dash-login" class="dash-login">
                <div class="login-card">
                    <div class="login-icon">üîí</div>
                    <h2>Dashboard Access</h2>
                    <p>Enter password to access the dashboard</p>
                    <div class="login-hint">üí° Password: <code>admin</code></div>
                    <div class="input-group">
                        <input type="password" id="dash-password" placeholder="Password" class="input-field">
                        <button id="btn-login" class="btn-primary">Enter</button>
                    </div>
                    <p id="login-error" class="login-error hidden">Invalid password</p>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dash-content" class="hidden">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <p class="page-subtitle">Analysis history & AI assistant</p>
                </div>

                <!-- Stats Row -->
                <div class="stats-row" id="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total Cases</div>
                    </div>
                    <div class="stat-card stat-approved">
                        <div class="stat-value" id="stat-approved">0</div>
                        <div class="stat-label">Approved</div>
                    </div>
                    <div class="stat-card stat-rejected">
                        <div class="stat-value" id="stat-rejected">0</div>
                        <div class="stat-label">Rejected</div>
                    </div>
                    <div class="stat-card stat-review">
                        <div class="stat-value" id="stat-review">0</div>
                        <div class="stat-label">Review</div>
                    </div>
                </div>

                <div class="dash-layout">
                    <!-- Cases Table -->
                    <div class="cases-panel">
                        <div class="panel-header">
                            <h3>üìã Analysis History</h3>
                            <button id="btn-refresh" class="btn-ghost btn-sm">‚Üª Refresh</button>
                        </div>
                        <div id="cases-table" class="cases-table">
                            <p class="muted">Loading cases...</p>
                        </div>
                    </div>

                    <!-- AI Chat -->
                    <div class="chat-panel">
                        <div class="panel-header">
                            <h3>ü§ñ AI Assistant</h3>
                            <span class="badge badge-ai">Gemini</span>
                        </div>
                        <div id="chat-messages" class="chat-messages">
                            <div class="chat-msg bot">
                                <div class="msg-avatar">ü§ñ</div>
                                <div class="msg-bubble">Hello! I'm your fraud analysis AI assistant. I have access to
                                    all analysis results. Ask me anything about the cases, patterns, or fraud detection.
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-row">
                            <input type="text" id="chat-input" placeholder="Ask about fraud patterns..."
                                class="input-field">
                            <button id="btn-send" class="btn-primary">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê PAGE: API ‚ïê‚ïê‚ïê -->
        <section id="page-api" class="page">
            <div class="page-header">
                <h1>API Documentation</h1>
                <p class="page-subtitle">Integrate fraud detection into your system</p>
            </div>

            <div class="api-layout">
                <!-- Health Status -->
                <div class="api-card">
                    <div class="api-card-header">
                        <span class="api-method get">GET</span>
                        <code>/health</code>
                        <button class="btn-ghost btn-sm" onclick="testHealth()">‚ñ∂ Test</button>
                    </div>
                    <p>Check API health and status</p>
                    <pre id="health-response" class="code-block">Click "Test" to check health</pre>
                </div>

                <!-- Analyze endpoint -->
                <div class="api-card">
                    <div class="api-card-header">
                        <span class="api-method post">POST</span>
                        <code>/api/v1/analyze</code>
                    </div>
                    <p>Analyze a passport document for fraud. Upload as multipart form data.</p>
                    <h4>Request</h4>
                    <pre class="code-block">curl -X POST http://localhost:8000/api/v1/analyze \
  -F "file=@passport.jpg"</pre>
                    <h4>Response</h4>
                    <pre class="code-block">{
  "case_id": "uuid",
  "final_decision": "APPROVED | REJECTED | REVIEW",
  "final_score": 0.95,
  "quality": { "quality_ok": true, "quality_score": 0.92 },
  "ocr": { "fields": [...], "avg_confidence": 0.98 },
  "rules": { "rules_passed": 10, "violations": [] },
  "llm": { "fraud_probability": 0.05, "recommendation": "APPROVE" }
}</pre>
                </div>

                <!-- Auth endpoint -->
                <div class="api-card">
                    <div class="api-card-header">
                        <span class="api-method post">POST</span>
                        <code>/api/v1/auth</code>
                    </div>
                    <p>Authenticate to access dashboard features.</p>
                    <pre class="code-block">curl -X POST http://localhost:8000/api/v1/auth \
  -H "Content-Type: application/json" \
  -d '{"password": "admin"}'</pre>
                </div>

                <!-- Cases endpoint -->
                <div class="api-card">
                    <div class="api-card-header">
                        <span class="api-method get">GET</span>
                        <code>/api/v1/cases</code>
                    </div>
                    <p>List all analysis runs. Returns case history for dashboard and RAG.</p>
                    <pre class="code-block">curl http://localhost:8000/api/v1/cases?limit=50&offset=0</pre>
                </div>

                <!-- Chat endpoint -->
                <div class="api-card">
                    <div class="api-card-header">
                        <span class="api-method post">POST</span>
                        <code>/api/v1/chat</code>
                    </div>
                    <p>Chat with the AI assistant about fraud analysis data.</p>
                    <pre class="code-block">curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "What patterns do you see in recent cases?"}'</pre>
                </div>

                <!-- Swagger -->
                <div class="api-card">
                    <div class="api-card-header">
                        <span class="api-method get">GET</span>
                        <code>/docs</code>
                    </div>
                    <p>Interactive Swagger UI documentation. <a href="/docs" target="_blank" class="link">Open Swagger
                            UI ‚Üí</a></p>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê PAGE: PIPELINE ‚ïê‚ïê‚ïê -->
        <section id="page-pipeline" class="page">
            <div class="page-header">
                <h1>Pipeline Architecture</h1>
                <p class="page-subtitle">What happens when an image enters the system</p>
            </div>

            <div class="pipeline-flow">
                <!-- Step 1 -->
                <div class="pipeline-step">
                    <div class="step-number">1</div>
                    <div class="step-card">
                        <div class="step-icon">üì∏</div>
                        <h3>Image Upload</h3>
                        <p>Document image (JPEG/PNG) enters the pipeline via API or web interface.</p>
                        <div class="step-tech">FastAPI ¬∑ Multipart Upload</div>
                    </div>
                </div>
                <div class="pipeline-arrow">‚Üí</div>

                <!-- Step 2 -->
                <div class="pipeline-step">
                    <div class="step-number">2</div>
                    <div class="step-card">
                        <div class="step-icon">üîç</div>
                        <h3>Quality Gate</h3>
                        <p>OpenCV checks blur (Laplacian variance), brightness (HSV), resolution, and document framing
                            (multi-strategy contour detection).</p>
                        <div class="step-tech">OpenCV ¬∑ Canny ¬∑ Adaptive Threshold</div>
                        <div class="step-metrics">
                            <span>~50ms</span>
                            <span>4 checks</span>
                        </div>
                    </div>
                </div>
                <div class="pipeline-arrow">‚Üí</div>

                <!-- Step 3 -->
                <div class="pipeline-step">
                    <div class="step-number">3</div>
                    <div class="step-card">
                        <div class="step-icon">üìù</div>
                        <h3>Hybrid OCR</h3>
                        <p><strong>PaddleOCR v5</strong> reads the MRZ zone (monospace OCR-B font, 99%+ accuracy).
                            <strong>EasyOCR</strong> extracts VIZ text (names, dates, nationality).
                        </p>
                        <div class="step-tech">PaddleOCR v5 ¬∑ EasyOCR ¬∑ ICAO 9303</div>
                        <div class="step-metrics">
                            <span>~2-5s</span>
                            <span>10+ fields</span>
                        </div>
                    </div>
                </div>
                <div class="pipeline-arrow">‚Üí</div>

                <!-- Step 4 -->
                <div class="pipeline-step">
                    <div class="step-number">4</div>
                    <div class="step-card">
                        <div class="step-icon">‚öñÔ∏è</div>
                        <h3>Rules Engine</h3>
                        <p>10 ICAO 9303 rules: MRZ format, 5 checksums (doc number, DOB, DOE, personal, composite),
                            country code, date plausibility, required fields, VIZ‚ÜîMRZ cross-check.</p>
                        <div class="step-tech">ICAO 9303 ¬∑ ISO 3166 ¬∑ Check Digits</div>
                        <div class="step-metrics">
                            <span>~2ms</span>
                            <span>10 rules</span>
                        </div>
                    </div>
                </div>
                <div class="pipeline-arrow">‚Üí</div>

                <!-- Step 5 -->
                <div class="pipeline-step">
                    <div class="step-number">5</div>
                    <div class="step-card">
                        <div class="step-icon">üß†</div>
                        <h3>LLM Analysis</h3>
                        <p>Gemini 2.0 Flash receives OCR fields + rules violations and provides semantic fraud
                            assessment, anomaly detection, and recommendation.</p>
                        <div class="step-tech">Gemini 2.0 Flash ¬∑ Structured JSON</div>
                        <div class="step-metrics">
                            <span>~1-3s</span>
                            <span>AI verdict</span>
                        </div>
                    </div>
                </div>
                <div class="pipeline-arrow">‚Üí</div>

                <!-- Step 6 -->
                <div class="pipeline-step">
                    <div class="step-number">6</div>
                    <div class="step-card final-step">
                        <div class="step-icon">üõ°Ô∏è</div>
                        <h3>Decision & Storage</h3>
                        <p>Total decision computed:<br>
                            <strong>APPROVED</strong><br>
                            <strong>REJECTED</strong><br>
                            <strong>REVIEW</strong><br>
                            Results stored for Dashboard & RAG.
                        </p>
                        <div class="step-tech">PostgreSQL ¬∑ pgvector ¬∑ RAG</div>
                        <div class="step-metrics">
                            <span>Total ~3-8s</span>
                            <span>Full JSON</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script src="app.js"></script>
</body>

</html>